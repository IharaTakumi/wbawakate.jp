extends /_layout/_default-layout

prepend config-block
  -
    let eventArr = _.values(events).reduce((p, c) => p.concat(c), []);
    let event = eventArr.filter(m => m.id === meta.id)[0]

    let title = meta.title || event.title

append config-block
  - pageId = 'event-detail'
  - rootPath = '../../'
  - imgPath = `${rootPath}img/event/${event.id}/`
  - title = `${title} | ${settings.site_name}`
  - ogp_image_url = meta.image ? `${settings.url}img/event/${meta.image}` : settings.ogp_image_url
  - url = `${settings.url}event/${meta.id}/`

block content-block
  main
    .front-block
      .body.hover-effect
        //- from [JavaScript：unescapeHTMLの妥当な実装: Architect Note](http://blog.tojiru.net/article/211339637.html)
        -
          bodyUnescaped = body
            .replace("&amp;", /&/g)
            .replace(/&lt;/g,'<')
            .replace(/&gt;/g,'>')
            .replace(/&amp;/g,'&')
            .replace(/&quot;/g,'"')
            .replace(/&#39;/g, "'")
          ;
        -
          opts = {
            imgPath,
            imageLink: (opts) => {
              const { src, alt } = opts;
              return `<span class="image-link"><img class="elm-img" src="${imgPath}${src}" alt="${alt}"></span>`;
            },
          };
        != _.template(bodyUnescaped)(opts)
